/**
 * Created by A.J on 2016/10/7.
 */
$(document).ready(function(){0<$("#fabushijian").length&&$("#fabushijian").datetimepicker({format:"yyyy-mm-dd hh:ii:ss"});var e="",i="",a="",e=$("#suolvetu").html();""!=$("#slt").val()&&($("#suolvetu img").attr("src",$("#slt").val()),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),""!=$("#fujian").val()&&(n=$("#fujian").val().split("|"),$("#fujianuploaddiv").html(""),$.each(n,function(e,a){a=a.split(":"),a=$("#fujiandiv").html().replace("#fujianming#",a[1]).replace("#fujianurl#",a[0]);$("#fujianuploaddiv").append(a)})),$("#upload").uploadify({auto:!0,fileTypeExts:"*.jpg;*.png;*.gif;*.jpeg",multi:!1,formData:{},fileSizeLimit:9999,buttonText:$("#buttonText").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:"upload",onUploadComplete:function(e,a){i=$("#webroot").text()+"data/uploads/"+a.replace("\\","/"),$("#bendi .panel-body").html('<img src="'+i+'" class="img-responsive" alt="Responsive image">')}}),$("#queding").click(function(){e=$("#suolvetu").html(),$("#xuanbendi").hasClass("active")&&""!=i?($("#suolvetu").html('<img src="'+i+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(i).trigger("change")):$("#xuanwangluo").hasClass("active")&&""!=a&&($("#suolvetu").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(a).trigger("change")),""==i&&""==a||($("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),$("#myModal").modal("hide")}),$("#quxiaotu").click(function(){$("#suolvetu").html(e),$("#slt").val("").trigger("change"),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")}),$("#wangluodizhi").change(function(){a=$("#wangluodizhi").val(),$("#wangluo .panel-body").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">')}),$("#templatex").html(remark[$("#template").val()]),$("#template").change(function(){remark[$("#template").val()]?$("#templatex").html(remark[$("#template").val()]):$("#templatex").html("")}),""!=$("#fenlei").val()&&$("#meiyexianshidiv").removeClass("hidden"),$("#fenlei").change(function(){""!=$("#fenlei").val()?$("#meiyexianshidiv").removeClass("hidden"):$("#meiyexianshidiv").addClass("hidden")});var t,n,l=$("#pagename").text(),o=!1,s=jLos.open(0,5e3);s.isValid&&0<$("#catfish").length&&(o=!0,"1"==$("#issaved").text()?s.remove(l):""!=(t=s.get(l))&&"object"==typeof t&&t.id==$("#pid").val()&&($("#biaoti").val(t.biaoti),$("#template option[value='"+t.template+"']").prop("selected",!0),$("#templatex").html(remark[$("#template").val()]),$("#zuozhe").val(t.zuozhe),$("#bianji").val(t.bianji),$("#guanjianci").val(t.guanjianci),$("#zhaiyao").val(t.zhaiyao),$("#fenlei option[value='"+t.fenlei+"']").prop("selected",!0),""!=t.fenlei?$("#meiyexianshidiv").removeClass("hidden"):$("#meiyexianshidiv").addClass("hidden"),$("#meiyexianshi").val(t.meiyexianshi),$("#fujian").val(t.fujian),$("#fujianurl").val(t.fujianurl),""!=t.fujian&&(n=t.fujian.split("|"),$("#fujianuploaddiv").html(""),$.each(n,function(e,a){a=a.split(":"),a=$("#fujiandiv").html().replace("#fujianming#",a[1]).replace("#fujianurl#",a[0]);$("#fujianuploaddiv").append(a)})),""!=t.slt?($("#slt").val(t.slt),$("#suolvetu img").attr("src",t.slt),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")):($("#suolvetu").html(e),$("#slt").val(""),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")),window.onload=function(){$.setEditorContent(t.neirong)}),$(document).keyup(function(e){$.record(l)}),$("#template, #fenlei, #slt").on("change",function(){$.record(l)}),$(document).on("click",function(e){setTimeout(function(){$.record(l)},0)}),$("#push").confirm({title:$("#quedingtuisong").text(),content:$("#tuisongshuoming").text(),confirmButton:$("#jixu").text(),cancelButton:$("#quxiao").text(),confirm:function(){var i=this.$target;i.children("span:last").removeClass("hidden"),$.post("writepush",{act:"push",name:l,pid:$("#pid").val(),jval:JSON.stringify(s.get(l)),verification:$("#verification").text()},function(e){var a;i.children("span:last").addClass("hidden"),"ok"==e.result?(a=$.alert({title:"",content:$("#yituisong").text(),confirmButton:$("#ok").text()}),setTimeout(function(){a.close()},1e3)):$.alert({title:$("#chucuo").text(),content:e.message,confirmButton:$("#ok").text()})})}}),$("#pull").on("click",function(e){var t=$(this);t.children("span:last").removeClass("hidden"),$.post("writepull",{act:"pull",name:l,pid:$("#pid").val(),verification:$("#verification").text()},function(e){var a,i;t.children("span:last").addClass("hidden"),"ok"==e.result?(a=JSON.parse(e.value),s.set(l,a),i=$.alert({title:"",content:$("#lacheng").text(),confirmButton:$("#ok").text()}),setTimeout(function(){i.close(),window.location.reload()},1e3)):$.alert({title:$("#shibai").text(),content:e.message,confirmButton:$("#ok").text()})})})),$("#fujianupload").uploadify({auto:!0,fileTypeExts:"*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.mp3;*.mp4;*.txt;*.zip;*.rar;*.gz;*.bz2;*.pdf;*.apk;*.swf",multi:!1,formData:{act:"fujianupload",verification:$("#verification").text()},fileSizeLimit:999999,buttonText:$("#choosefile").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:"fujianupload",onUploadComplete:function(e,a){var i;"ok"==(a=JSON.parse(a)).result?(i=$("#fujiandiv").html().replace("#fujianming#",a.info.name).replace("#fujianurl#",a.message),$("#fujianuploaddiv").append(i),""==$("#fujian").val()?$("#fujian").val(a.message+":"+a.info.name):$("#fujian").val($("#fujian").val()+"|"+a.message+":"+a.info.name),o&&$.record(l)):$.alert({title:$("#shibai").text(),content:a.message,confirmButton:$("#ok").text()})}}),$('[data-toggle="popover"]').popover(),$("#fujianuploaddiv").on("click",".shanchufujian",function(e){var t=$(this);t.next("span").removeClass("hidden");var n=$(this).parent().children(":last").text();$.post("shanchufujian",{act:"shanchufujian",fujianming:n,verification:$("#verification").text()},function(e){var i,a;t.next("span").addClass("hidden"),"ok"==e.result?(i="",a=$("#fujian").val().split("|"),$.each(a,function(e,a){a.split(":")[0]!=n&&(""==i?i=a:i+="|"+a)}),$("#fujian").val(i),t.parent().parent().parent().parent().remove(),o&&$.record(l)):$.alert({title:$("#chucuo").text(),content:e.message,confirmButton:$("#ok").text()})})}),!$.isFunction($.getQueryString)||""!=(n=$.getQueryString(["editor"]))&&$("#switchEditor").attr("href",$("#switchEditor").attr("href")+"&"+n),""==$("#zuozhe").val()&&""==$("#bianji").val()&&$.post("getnick",{act:"getnick",verification:$("#verification").text()},function(e){""==$("#zuozhe").val()&&""==$("#bianji").val()&&($("#zuozhe").val(e),$("#bianji").val(e))}),$.extend({record:function(e){var a={};a.id=$("#pid").val(),a.biaoti=$("#biaoti").val(),a.template=$("#template").val(),a.neirong=$.getEditorContent(),a.zuozhe=$("#zuozhe").val(),a.bianji=$("#bianji").val(),a.guanjianci=$("#guanjianci").val(),a.zhaiyao=$("#zhaiyao").val(),a.fenlei=$("#fenlei").val(),a.meiyexianshi=$("#meiyexianshi").val(),a.fujian=$("#fujian").val(),a.fujianurl=$("#fujianurl").val(),a.slt=$("#slt").val(),s.set(e,a)}})});