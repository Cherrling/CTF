/**
 * Created by A.J on 2016/10/2.
 */
$(document).ready(function(){0<$("#fabushijian").length&&$("#fabushijian").datetimepicker({format:"yyyy-mm-dd hh:ii:ss"});var t="",a="",e="",t=$("#suolvetu").html();""!=$("#slt").val()&&($("#suolvetu img").attr("src",$("#slt").val()),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),0<$("#fujian").length&&""!=$("#fujian").val()&&(l=$("#fujian").val().split("|"),$("#fujianuploaddiv").html(""),$.each(l,function(t,e){e=e.split(":"),e=$("#fujiandiv").html().replace("#fujianming#",e[1]).replace("#fujianurl#",e[0]);$("#fujianuploaddiv").append(e)})),$("#upload").uploadify({auto:!0,fileTypeExts:"*.jpg;*.png;*.gif;*.jpeg",multi:!1,formData:{upload:1},fileSizeLimit:9999,buttonText:$("#buttonText").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:$("#upload_url").text(),onUploadComplete:function(t,e){a=$("#webroot").text()+"data/uploads/"+e.replace("\\","/"),$("#bendi .panel-body").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">')}}),$("#queding").click(function(){t=$("#suolvetu").html(),$("#xuanbendi").hasClass("active")&&""!=a?($("#suolvetu").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(a).trigger("change")):$("#xuanwangluo").hasClass("active")&&""!=e&&($("#suolvetu").html('<img src="'+e+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(e).trigger("change")),""==a&&""==e||($("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),$("#myModal").modal("hide")}),$("#quxiaotu").click(function(){$("#suolvetu").html(t),$("#slt").val("").trigger("change"),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")}),$("#wangluodizhi").change(function(){e=$("#wangluodizhi").val(),$("#wangluo .panel-body").html('<img src="'+e+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(e).trigger("change")});var i,n,l,o=$("#writename").text(),s=jLos.open(0,5e3),u=!1;s.isValid&&0<$("#catfish").length&&(u=!0,"1"==$("#issaved").text()?s.remove(o):""!=(i=s.get(o))&&"object"==typeof i&&i.id==$("#pid").val()&&($("#biaoti").val(i.biaoti),$("#zuozhe").val(i.zuozhe),$("#bianji").val(i.bianji),$("#guanjianci").val(i.guanjianci),$("#laiyuan").val(i.laiyuan),$("#zhaiyao").val(i.zhaiyao),$("#fujian").val(i.fujian),$("#fujianurl").val(i.fujianurl),void 0!==i.fujian&&""!=i.fujian&&(l=i.fujian.split("|"),$("#fujianuploaddiv").html(""),$.each(l,function(t,e){e=e.split(":"),e=$("#fujiandiv").html().replace("#fujianming#",e[1]).replace("#fujianurl#",e[0]);$("#fujianuploaddiv").append(e)})),""!=i.slt?($("#slt").val(i.slt),$("#suolvetu img").attr("src",i.slt),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")):($("#suolvetu").html(t),$("#slt").val(""),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")),""!=(n=i.fenlei)&&(n=n.split(","),$("#fenlei option").each(function(){-1<$.inArray($(this).val(),n)&&$(this).prop("selected",!0)})),$("input[type='radio'][name='zhiding'][value="+i.zhiding+"]").prop("checked",!0),$("input[type='radio'][name='tuijian'][value="+i.tuijian+"]").prop("checked",!0),$("input[type='radio'][name='pinglun'][value="+i.pinglun+"]").prop("checked",!0),$("input[type='radio'][name='xingshi'][value="+i.xingshi+"]").prop("checked",!0),window.onload=function(){$.setEditorContent(i.neirong)}),$(document).keyup(function(t){$.record(o)}),$("#fenlei, #slt, input[type='radio']").on("change",function(){$.record(o)}),$(document).on("click",function(t){setTimeout(function(){$.record(o)},0)}),$("#push").confirm({title:$("#quedingtuisong").text(),content:$("#tuisongshuoming").text(),confirmButton:$("#jixu").text(),cancelButton:$("#quxiao").text(),confirm:function(){var a=this.$target;a.children("span:last").removeClass("hidden"),$.post("writepush",{act:"push",name:o,pid:$("#pid").val(),jval:JSON.stringify(s.get(o)),verification:$("#verification").text()},function(t){var e;a.children("span:last").addClass("hidden"),"ok"==t.result?(e=$.alert({title:"",content:$("#yituisong").text(),confirmButton:$("#ok").text()}),setTimeout(function(){e.close()},1e3)):$.alert({title:$("#chucuo").text(),content:t.message,confirmButton:$("#ok").text()})})}}),$("#pull").on("click",function(t){var i=$(this);i.children("span:last").removeClass("hidden"),$.post("writepull",{act:"pull",name:o,pid:$("#pid").val(),verification:$("#verification").text()},function(t){var e,a;i.children("span:last").addClass("hidden"),"ok"==t.result?(e=JSON.parse(t.value),s.set(o,e),a=$.alert({title:"",content:$("#lacheng").text(),confirmButton:$("#ok").text()}),setTimeout(function(){a.close(),window.location.reload()},1e3)):$.alert({title:$("#shibai").text(),content:t.message,confirmButton:$("#ok").text()})})})),$("#fujianupload").uploadify({auto:!0,fileTypeExts:"*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.mp3;*.mp4;*.txt;*.zip;*.rar;*.gz;*.bz2;*.pdf;*.apk;*.swf",multi:!1,formData:{act:"fujianupload",verification:$("#verification").text()},fileSizeLimit:999999,buttonText:$("#choosefile").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:"fujianupload",onUploadComplete:function(t,e){var a;"ok"==(e=JSON.parse(e)).result?(a=$("#fujiandiv").html().replace("#fujianming#",e.info.name).replace("#fujianurl#",e.message),$("#fujianuploaddiv").append(a),""==$("#fujian").val()?$("#fujian").val(e.message+":"+e.info.name):$("#fujian").val($("#fujian").val()+"|"+e.message+":"+e.info.name),u&&$.record(o)):$.alert({title:$("#shibai").text(),content:e.message,confirmButton:$("#ok").text()})}}),$('[data-toggle="popover"]').popover(),$("#fujianuploaddiv").on("click",".shanchufujian",function(t){var i=$(this);i.next("span").removeClass("hidden");var n=$(this).parent().children(":last").text();$.post("shanchufujian",{act:"shanchufujian",fujianming:n,verification:$("#verification").text()},function(t){var a,e;i.next("span").addClass("hidden"),"ok"==t.result?(a="",e=$("#fujian").val().split("|"),$.each(e,function(t,e){e.split(":")[0]!=n&&(""==a?a=e:a+="|"+e)}),$("#fujian").val(a),i.parent().parent().parent().parent().remove(),u&&$.record(o)):$.alert({title:$("#chucuo").text(),content:t.message,confirmButton:$("#ok").text()})})}),!$.isFunction($.getQueryString)||""!=(l=$.getQueryString(["editor"]))&&$("#switchEditor").attr("href",$("#switchEditor").attr("href")+"&"+l),$("#savetemplatebutton").on("click",function(t){var a=$(this);a.children("span").removeClass("hidden"),$("#savetemplateload").removeClass("hidden"),$.post("savetemplate",{act:"savetemplate",mid:$("#savetemplate").data("mid"),name:$("#templatename").val(),content:$.getEditorContent(),verification:$("#verification").text()},function(t){var e;a.children("span").addClass("hidden"),$("#savetemplateload").addClass("hidden"),"ok"==t.result?($("#savetemplate-modal").modal("hide"),$("#templatename").val(""),e=$.alert({title:"",content:t.message,confirmButton:$("#ok").text()}),setTimeout(function(){e.close()},1e3)):$.alert({title:$("#shibai").text(),content:t.message,confirmButton:$("#ok").text()})})}),$("#choosetemplate").on("click",function(t){$("#choosetemplatecontent").html($("#choosetemplateload").html()),$.post("loadtemplate",{act:"loadtemplate",verification:$("#verification").text()},function(t){var a,i,n;"ok"==t.result?(i=a="",n=3,$.each(t.message,function(t,e){i+=$("#mubandiv").html().replace("#name#",e.tname).replace("#iddiv#",e.id).replace("#yulandiv#",e.tcontent),--n<=0&&(n=3,a+='<div class="row">'+i+"</div>",i="")}),""!=i&&(a+='<div class="row">'+i+"</div>"),$("#choosetemplatecontent").html('<div class="container-fluid">'+a+"</div>")):($("#choosetemplate-modal").modal("hide"),$.alert({title:$("#shibai").text(),content:t.message,confirmButton:$("#ok").text()}))})}),$("#choosetemplatecontent").on("click",".yulan",function(t){$("#yulancontent").html($(this).parent().siblings("div:last").html()),$("#yulancontentid").text($(this).parent().siblings("div:first").text()),$("#yulancontentname").text($(this).parent().parent().siblings("div:first").text()),$("#choosetemplate-modal").modal("hide"),$("#yulan-modal").modal("show")}),$("#yulancontentclose, #yulanfanhui").on("click",function(t){$("#yulan-modal").modal("hide"),$("#choosetemplate-modal").modal("show")}),$("#choosetemplatecontent").on("click",".shiyong",function(t){$.setEditorContent($(this).parent().siblings("div:last").html()),0<$("#savetemplate").length&&($("#savetemplate").data("mid",$(this).parent().siblings("div:first").text()),$("#savetemplate").data("name",$(this).parent().parent().siblings("div:first").text())),$("#choosetemplate-modal").modal("hide")}),$("#shiyongtemp").on("click",function(t){$.setEditorContent($("#yulancontent").html()),0<$("#savetemplate").length&&($("#savetemplate").data("mid",$("#yulancontentid").text()),$("#savetemplate").data("name",$("#yulancontentname").text())),$("#yulan-modal").modal("hide")}),$("#savetemplate-modal").on("show.bs.modal",function(t){0<$("#savetemplate").length&&$("#templatename").val($("#savetemplate").data("name"))}),$("#laiyuanqueding").on("click",function(t){$("#laiyuan").val("<a href='"+$("#laiyuandizhi").val()+"' target='_blank'>"+$("#laiyuanming").val()+"</a>"),$.record(o),$("#laiyuanhtml").modal("hide")}),""==$("#zuozhe").val()&&""==$("#bianji").val()&&$.post("getnick",{act:"getnick",verification:$("#verification").text()},function(t){""==$("#zuozhe").val()&&""==$("#bianji").val()&&($("#zuozhe").val(t),$("#bianji").val(t))}),$.extend({record:function(t){var e={};e.id=$("#pid").val(),e.biaoti=$("#biaoti").val(),e.neirong=$.getEditorContent(),e.zuozhe=$("#zuozhe").val(),e.bianji=$("#bianji").val(),e.guanjianci=$("#guanjianci").val(),e.laiyuan=$("#laiyuan").val(),e.zhaiyao=$("#zhaiyao").val(),e.fujian=$("#fujian").val(),e.fujianurl=$("#fujianurl").val(),e.slt=$("#slt").val();var a="";$("#fenlei option:selected").each(function(){""==a?a=$(this).val():a+=","+$(this).val()}),e.fenlei=a;var i=$("input[type='radio'][name='zhiding']:checked").val(),n=$("input[type='radio'][name='tuijian']:checked").val(),l=$("input[type='radio'][name='pinglun']:checked").val(),o=$("input[type='radio'][name='xingshi']:checked").val();e.zhiding=i,e.tuijian=n,e.pinglun=l,e.xingshi=o,s.set(t,e)}})});