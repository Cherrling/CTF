from secrets import flag, key1, key2, key3
from Crypto.Util.number import *
from sympy.ntheory import prevprime
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
from random import *
import gmpy2
import os

key1=long_to_bytes(key1)
p = getPrime(256)
q = getPrime(256)

n = p*q
e = 65537
N = 8
assert len(key1) <= N^2
key1 += os.urandom(N^2-len(key1))
m = [int(x) for x in key1]
m = [m[N*i : N*(i+1)] for i in range(N)]
m = matrix(IntegerModRing(n), m)
assert m.det() != 0
c = pow(m, e)
print('n = %d' % n)
print(c)


p = key2
a = randint(0,p)
b = randint(0,p)
E = EllipticCurve(GF(p),[a,b])
G1,G2 = [E.random_element(),E.random_element()]

print(f'a = {a}')
print(f'b = {b}')
print(f'G1 = {G1}')
print(f'G2 = {G2}')


q = prevprime(q)
A = []
B = []
for i in range(Round+1):
    a = getRandomInteger(256)
    A.append(a)
    b = (a * key3 % q) & (2 ** 8 - 1)
    B.append(b)
print(q)
print(A)
print(B)


key = key1 ^ key2 ^ key3
key = long_to_bytes(key)

aes = AES.new(key,mode = AES.MODE_ECB)
print(aes.encrypt(pad(flag,16)))




'''
n = 4885743456507661096773200261718387399660649956751202185229731472525022424226692986859179114988810653770226721260184574574929451483062518480376351797314511
[4862635051102894995353781926828864940087592193808414737849246123726218364490133366902984458461825762865293128143543445086582007654911489158257203298819906 3761694889575153204808579214638039925012222569121151742828823735376213926670942761482533648731053042754268369169385915453663472663935871550139651735818621 4134462140509595730598951866648998782746107380459697691453254474251585593554019906587547073631293781866563238445798838473621095036204111854973842429012071 4069566615722082232144284497718892349932602819959316582644804614122797911985375222491289120152519825987153973764754818585343781608896786889935328730537753 4734486115837454448199567369937189006259723443988261182496245511858931694328417952615065153346392189519307467329762475048955548333139703393889032919735566  877200631816922034197278305808354331299229187865313841035640077805500224591349655099384974044180662053174920413466753683902304524745550864369192350655824 1123321653942804415057631311489929671589038963806413251793622048845314391339159861425918859818642505978353135028801226635378430617592946821153192505826479  830718326178408232019914881697441816742318072497543640775567522795926261970739282237092450426398062752158053393802486390864704884233303170931135279382798]
[ 786951703707919818993369773351222291200722208964667361843257975674803680495655007873868608140236603066706324143591351178511145918479195042940191097964360 3095891252534474771369056538545822033811893141076612149148937474129498108838033789383274830905131621756108333416269215874519040961208256433244041866264298  922045602192565350423584350582199461571435632332292546603427492261907152578570483042763197680747760067125239335281546857198161506824630489756988024050493   71059859367741960081756139696629063506527016349925309526564019450156484660752695967172095881984462860410894785917635531966000236315149814383177636555022 3847116089998891837544689486454897052920711955081297793034981195752721786281575759562625473535213955721707077030018231164251903513651752818482034264762881 4720452887002216979405926041520691608628615229392775683375539887734979810613952880476280574608359636861190507430659170244444974201213634227249084502935761  371710336688297071237945651894957329513799396310850842116088359864663088546107013489109289327483310677061308515478947285945493658943835185628667573348854  143512822645118362049608019091483511017011168309065211894022641536934907451732459129996140502716976410004201643472417553437118163905671670736868855107415]
[3432426610572389776755542746866462916865306483522335649898779006077401298699385802738326899411547295876922275313099065677815658547083719540788008283487779 4208163351612329593149306069373991783080589414953390954824754567277938682491131141046185726266159471823597960525430028012779985540027685362460649046428042  478927041970278165011896816435747596392775492664479311342682779084803529923189418608022358356102690729426969367882504658889765417301212084511165244996738 1612728718646693729401128673192651864851809845303406957572101918479935516232332935399728089893099300166004769955840819780851241299004962362830283353440051 4305130839981959572897754614868561512474793400055437151839670985264840319450402751439140197696410311967785316102839670181563455202439451588032237047628586 3421247259961370343493780086055238550730437058409272221777317660084800319188606398417803010866045005948803888987447424708627428689307500473117688297962020 2864038727711897976146786445391691078565648259451418146124979525993774475835294784728981769310044040828866186654730951846013539235874874656246766077544898  362377974931444688630827572151411152605083196030948140135204127640329450412185779837614590336266021381491186872118923632067729569051475013742516573429074]
[2198216607444266899748682690762938136146198021810717971937979103614775010340316597018639921582152171822478364350114878884857014266020785173023800581977457 2634020015942555560779150836695717769343844231097236468144540337900916790808553656716964378160142280233506646487098134608967336844229161719944272665860946 2373022550324848597678978400367591732924958569344173883982615898678941848962956971679860279591978133475513243020576541957858157767644883928047736175946145 1769290659178698514522316182612686924391784303386298536868127408989538232174646026630938352609179211471111076674309923895386268228166046617217691279357397 4382832921356954375265497340452947695618471961726537033485501465643579568025633562505748690772970130305306119631124479411248624415439614269720441723051658 1718841656987770107773824229208581787745101487299357144100556706615918052362208067037009962926862135614992259975838223877765249642530654373023685423927848 3273859431711562073311378516271361490353407351729795743271384449366911872925407007666800866275506872892164773874107190327434064732145761462362785632845153 3037894929637118883854180267695267020400755415492801917770692581367757779292671892675790345566430089320506400712325295542067213384937528986621674269193508]
[4607885020965289650010639928089907515673265573206344874623434270501595762539258472284935449077335204959800602402756463713004327834176594818976986906255261 2265565023595179274986268886217805492492527359400647339706218408626275635149121713902948154064100260503720766529239009492032398501359845997672339600250297 4874866736696945102836280379984550664269454985246692676509651839966140114622229419065847915664671955161871796570687079970688529317873346689538945909053823 1839786321641227049627926440328943046472125396302157955770982163600910081897542584384700961469800301727911365101585171436803259725284189617686829050314150 1188238304460054627899803059505687392488035854478962876680951067724026615774523731353940838457216016535571413182859069933762897208796900833212711349478395 2467120011897877280633906690587042300972178811721787473854471596166308799359879387382629126241965484403059996939360384209954420941778505384136377339914719 3332154989050696589825233917834085917971297672397925648995711603071877431983874655981352411168172986116131655191774376061701832189678092022174076524339596 2364334634934874531729037146131886274875129162843936227264059562991384434455725831295181248651413008788731330658727709685535861685244219502813019365298434]
[2452023431568185438377583641211044474097299564195124419349634383324126818380554251835935749540521125365591517026836399935974036370886663997892053310918520 1836593800803771995953516922243941440898655613589006628688254815858344298341483230520033487539174149856456200676101538162096259909495233459561845296653037 1009250133842550128543630466801994646166950216963061810512954101359656084862488145131408599027625604380850296284291656453238647967510728869699523047600117  688650885121964706814857731839879884168540299623713016715214972610782281042591591538928920123037888646546122790133333266496155298397088108507914822021816 2954439286032780138904604228147422210893062168378973107033413936933790065793280862685693336179584435866619814073085626650028888346318943173541951672335255 2796518637358931464217176734530787948673071427127245263926710535512553239269882613632352377005800430123212548957327000980857399372327017952400529933001686 3892551428317333182911486221096415236767228289581658023934812852031761295541075989925590269418285989130922279633353098960039386623757397281979580557462638  280018062893301377519385760804553869261452226224966020359452984486164534464243872711440522797171095666873832529440666418268630748630611481019590568284766]
[4265464793808557810675912810839300794792456080973541743706343279463558882379840538556981344777351419461060526416169663875813180513758464755565560078221476  619225060404496952717093105883689145623340534216004307098321112995854657986080173401425080253415266830048035597723201794364504937276667096226182075242007  664067302361778512628361318204556495823820362129578771521550233270353628455561641140211780752530628352572924322103479135847681354888363150653464114820731  978260462910501099972207699293355356872400657767748926156455776014294495425751615993303872679119535571024360370942619054216955886259412711587222810911874 4065495937616362863560316102653974506790546679238655350510773711331760500869456661441071034473596992171974265000557959180509439803569783955302670379730493 1633583650530323052271765965420826725458085406940017368409214702500079928583381598441130757956611548703765621378442042676507984022664840684130490639003008 2180161493140094009481977784215935922913346249824399147487298726233568105543613583494234070038516906073579793226610378859965949289492612993641367094474695 2760230271120339586487957253034394625085622898244169098211128153928448145372195548496364325693946858679125062227097156500068224261867505233108524693240553]
[2912494404073967726391690226034081595233192710497250568870130927241286369389745667145360163532598881618079606185869174292178210697411015995133782536266903 3079332815688179542645740224229093751981545804486665587759812738455226799279059994246000079676385914023213443476604885545294095117994739532066502334751462 4284446055530802392883065952869978785879204573620747273452862792130307482708744888894747378392548597619080516520337487796444251272393601897039750229701851 2867973528889231211226708069351326994257232773711479369177366773152194537185864522620217256525162822854956449190528786200622413570357286424950748348050554 1080832862008782421194072562996106978025480481120881413247260259890051252837087973943300382582150820591904043413806041517136353044321358814312326621418320  327716831150049816999348498074320857405377600617730823987520592039760372796356015075416299211580563790836599344789541907423271016561815996295317393541473 2160426393540252322154356560402098340907389484939156154647137263765996204087237192989305696103213990876270534316493055333464781101890823512901978588488090 4460705679890107797480655557504445781069892703122668888414973691908206815588768807190663309867139656726865798102423224646455653727971820676355702862601992]


a = 55516814819504250962837412018051627795575855143096120312744918126718490544136
b = 3130494486203492156666518979952326199547939529196662055707000746348647729828
G1 = (1575378408029529414829411472004568247049681243465909544166539539147304756408 : 3220315015800703937073384578473775396501952816886314605096402433289771778491 : 1)
G2 = (535429037293763773029643210163856717954763106419886792971777339150699003625 : 9249330843804929950236845838750272806392001874172033571433745972836101353085 : 1)


115792089237316195423570985008687907853269984665640564039457584007913129639747
[12957154334813786645286302174466439037285205748306516630013184499563843055854, 96836283585112509343126120632035122942106078557884188109490068576899762891387, 53888589163428876637708568001426620710282930732755615185195580015921770665290, 10506307049305554912918996550059589756199086119041061488886833203098791566222, 106559725974289366749927441984544987468704559339809547704992137582673365831975, 22908610009397034017444155718366084442693042234413481428761827877144372143144, 42513636177233726164542033509795680974610121105254760755610755868796995104856, 42758906691807728118914768091464209593076396928051012248991094282714738212875, 111421812040601835379345124984922874055469536816213656244557323163600533388974, 38544168392540093777338844080142894047967332303723187715500982229765249892604, 606625006511915637841147359440681961794164690785173161182239005938720079943, 106388904487463539681272300494384450644190176385552541487604318672125247495424, 34729718024649536626308261068424322409453992418181346598361568097360276322641, 71614694089203096571248696209794832748407483906016763700129192982516696247119, 78252650077197218027899938873326967181898596311315273175837714285684142902734, 6655332006528475556365298309224629916588811596746597583072378909781951472921, 42571623512727659279113666079094835398770341516536302225200358469220817110114, 69634623324323180131833959670518421121381464338241062671601815045478315018217, 24449680841136140462380118749183763614162804289252456506464913716411793936243, 87534719626175175582161890824823817534085261303946396682019804567960673068012, 38561597525396487713403831898089747046939016263649599791409449804363072261795, 69229269607235956412840607974429109838323940052582354792951327634559426146391, 115579262022470277425615170041930712459645877755796694815014235953515130106260, 48444944418077420389561234866546122336230471159571764096035711367913396912152, 85001158522538320026310438953929651420795720855512358842489482867377629108336, 26884523568341461651853327669027985026018928490058625424049315647782627029579, 23310490974579198524630431176523165908195370104598903607636338919339523940725, 28883021400376451389613480640486573708036259841382949377447150852982969465373, 99446204844294763678646174124005025823600529670228153077439887783527469054257, 36213981600589806895376671751978212646913052999427153260275205307678720629999, 25260312761610073710072954925497550062051660832118304159002949076469418347567, 12357725170774557952954886680413753659778957520540051925123022312343433555228, 32995711174947070181060959800792823828672194640734165264562664605781090728562]
[55, 241, 127, 246, 131, 115, 115, 51, 72, 35, 153, 141, 169, 115, 166, 164, 126, 254, 243, 101, 227, 158, 110, 22, 104, 219, 173, 84, 112, 2, 23, 143, 158]

b'\x1a\x12\xa9\x8e\xca\x9b\xf0\xf6X\xdb\x0f\tE\x15\xdaU-l@\x81\x13\xd2R\xcas\x91\x17\xc4\x05d2)I\x01\xb5\xdf\xed\xd2Ca;\xf6\xe6\x9d\x0e\x06\xb2H'
'''

